<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i Th·ª£ M·ªè Nh√†n R·ªói - 3D</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Li√™n k·∫øt ƒë·∫øn t·ªáp CSS ngo√†i -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="notification-container"></div>
    <div class="relative h-screen w-screen">
        <canvas id="game-canvas"></canvas>

        <div class="absolute top-4 left-4 panel !max-w-xs !py-2 !px-4">
             <div class="resource-item text-xl"><span>üí∞</span> <span id="money" class="font-bold text-green-400 transition-all">0 $</span></div>
        </div>

        <!-- Equipment Popup -->
        <div id="equipment-popup" class="absolute top-4 right-4 z-40 bg-slate-800/95 backdrop-blur-md border border-slate-600 rounded-lg p-3 shadow-lg min-w-[200px] pointer-events-none">
            <div class="text-xs text-slate-400 mb-2 font-semibold">TRANG B·ªä</div>
            <div class="mb-3">
                <div class="text-xs text-amber-400 mb-1">Anh h√πng:</div>
                <div id="equipped-heroes" class="flex gap-1">
                    <div class="text-xs text-slate-500 italic">Ch∆∞a c√≥</div>
                </div>
            </div>
            <div>
                <div class="text-xs text-cyan-400 mb-1">Di v·∫≠t:</div>
                <div id="equipped-artifacts" class="flex gap-1">
                    <div class="text-xs text-slate-500 italic">Ch∆∞a c√≥</div>
                </div>
            </div>
        </div>

        <div class="absolute bottom-4 left-4 pointer-events-none flex flex-col gap-4">
            <div id="panel-container" class="pointer-events-auto">
                <!-- Panels will be injected here by JS -->
            </div>
            <div class="flex gap-4 pointer-events-auto">
                <button id="toggle-upgrades" class="toggle-button" title="N√¢ng C·∫•p">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
                </button>
                 <button id="toggle-gacha" class="toggle-button" title="Quay Th∆∞·ªüng">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a7 7 0 1 0 10 7"/></svg>
                </button>
                 <button id="toggle-equipment" class="toggle-button" title="Trang b·ªã">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                </button>
                <button id="toggle-dungeon" class="toggle-button" title="Dungeon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 10l-4 4 6 6h6v-6l-4-4Z"/><path d="M4.5 11.5L2 14l3 3 2.5-2.5"/><path d="m18 2 4 4"/><path d="m2 2 4 4"/><path d="M21.5 14.5L19 12l-3 3 2.5 2.5"/><path d="M10 22l-6-6"/></svg>
                </button>
                <button id="toggle-stats" class="toggle-button" title="Th·ªëng k√™">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                </button>
                <button id="toggle-music" class="toggle-button" title="√Çm nh·∫°c">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
                </button>
            </div>
        </div>
    </div>
    
    <div id="gacha-modal">
        <div id="gacha-result-container" class="gacha-container"></div>
    </div>

    <div id="dungeon-combat-modal">
        <div id="dungeon-combat-container"></div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="confirmation-title" class="font-bold text-xl mb-2">X√°c nh·∫≠n</h2>
            <p id="confirmation-text" class="text-slate-300">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
            <div class="flex gap-4 mt-6">
                <button id="confirm-yes-btn" class="btn-primary !bg-red-600 flex-1">C√≥</button>
                <button id="confirm-no-btn" class="bg-slate-600 hover:bg-slate-500 text-white font-bold py-2 px-4 rounded-lg flex-1">Kh√¥ng</button>
            </div>
        </div>
    </div>


    <!-- Panel Templates -->
    <template id="template-upgrades">
        <div class="panel">
             <div class="tab-container">
                <button class="tab-button active" data-tab="player-content">B·∫°n</button>
                <button class="tab-button" data-tab="miners-content">Th·ª£ m·ªè</button>
                <button class="tab-button" data-tab="agents-content">Agent</button>
            </div>
            <div id="upgrades-content-container">
                <div id="player-content" class="tab-content space-y-3">
                    <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m14.5 5.5 5 5a2 2 0 0 1 0 2.82l-5 5a2 2 0 0 1-2.82 0l-5-5a2 2 0 0 1 0-2.82l5-5a2 2 0 0 1 2.82 0z"/><path d="m12 12 5 5"/><path d="M2 21h6"/><path d="m17 14-4-4"/></svg>
                            <span>N√¢ng c·∫•p Cu·ªëc <span class="text-sm text-slate-400">(Lv. <span id="clickPowerStat">1</span>)</span></span>
                        </h3>
                        <button id="upgradeClick" class="btn-primary"><span id="upgradeClickCost">20 $</span></button>
                    </div>
                     <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3h6l3 3v12a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6Z"/><path d="M9 3V1h6v2"/><path d="M10 12h4"/><path d="M12 10v4"/></svg>
                            <span>ƒê√†o Nhi·ªÅu √î <span class="text-sm text-slate-400">(Lv. <span id="mineMultiLevelStat">0</span>)</span></span>
                        </h3>
                        <button id="upgradeMineMulti" class="btn-primary"><span id="upgradeMineMultiCost">500 $</span></button>
                    </div>
                     <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 2.1l4 4-4 4"/><path d="M3 12.6A9 9 0 0 1 12 3a9 9 0 0 1 8.4 5.4"/><path d="M7 21.9l-4-4 4-4"/><path d="M21 11.4A9 9 0 0 1 12 21a9 9 0 0 1-8.4-5.4"/></svg>
                            <span>T·ª± ƒê·ªông ƒê√†o <span class="text-sm text-slate-400">(Lv. <span id="autoMineLevelStat">0</span>)</span></span>
                        </h3>
                        <button id="upgradeAutoMine" class="btn-primary"><span id="upgradeAutoMineCost">100 $</span></button>
                    </div>
                </div>
                <div id="miners-content" class="tab-content space-y-3 hidden">
                     <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            <span>Thu√™ Th·ª£ M·ªè <span class="text-sm text-slate-400">(<span id="minerCountStat">0</span>/5)</span></span>
                        </h3>
                        <button id="hireMiner" class="btn-primary"><span id="hireMinerCost">50 $</span></button>
                    </div>
                    <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3.5 21 14 10.5 21 21"/><path d="M21 3.5 10.5 14 3.5 3.5"/></svg>
                            <span>S·ª©c M·∫°nh <span class="text-sm text-slate-400">(Lv. <span id="minerPowerLevelStat">1</span>)</span></span>
                        </h3>
                        <button id="upgradeMinerPower" class="btn-primary"><span id="upgradeMinerPowerCost">200 $</span></button>
                    </div>
                     <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                            <span>Si√™u C·∫•p <span class="text-sm text-slate-400">(Lv. <span id="superMinerLevelStat">0</span>/5)</span></span>
                        </h3>
                        <button id="upgradeSuperMiner" class="btn-primary"><span id="upgradeSuperMinerCost">2000 $</span></button>
                    </div>
                     <div>
                        <h3 class="upgrade-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                            <span>Th·ªÉ L·ª±c <span class="text-sm text-slate-400">(Lv. <span id="minerStaminaLevelStat">0</span>)</span></span>
                        </h3>
                        <button id="upgradeMinerStamina" class="btn-primary"><span id="upgradeMinerStaminaCost">300 $</span></button>
                    </div>
                </div>
                <div id="agents-content" class="tab-content hidden">
                    <div class="flex items-start gap-4">
                        <img src="https://www.pngmart.com/files/24/Tung-Tung-Tung-Sahur-PNG-Photos.png" class="w-20 h-20 object-contain bg-slate-900/50 rounded-lg p-1" alt="Agent Tung tung tung sahuer">
                        <div class="flex-1">
                            <h3 class="font-bold text-lg">Tung tung tung sahuer</h3>
                            <p class="text-sm text-slate-400 mb-2">Ph√° h·ªßy m·ªôt kh·ªëi t√πy ch·ªçn ngay l·∫≠p t·ª©c. H·ªìi chi√™u: 60s.</p>
                            <div id="agentTungContainer">
                                <!-- Agent button is rendered dynamically by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="template-stats">
        <div class="panel !max-w-4xl max-h-[80vh] overflow-y-auto custom-scrollbar">
            <h2 class="font-bold text-lg text-center border-b border-slate-600 pb-2 mb-3">Th·ªëng K√™ Chi Ti·∫øt</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Column 1 -->
                <div class="space-y-6">
                    <div class="stats-section">
                        <h3 class="font-semibold text-base text-amber-400">Chung</h3>
                        <div class="stat-item"><span>‚õèÔ∏è T·∫ßng ƒë√£ ƒë√†o:</span> <span id="depthStat" class="font-bold text-purple-400">0</span></div>
                        <div class="stat-item"><span>üïí Th·ªùi gian ch∆°i:</span> <span id="timePlayed" class="font-bold">00:00:00</span></div>
                        <div class="stat-item"><span>üíé T·ªïng kh·ªëi ƒë√£ ƒë√†o:</span> <span id="blocksMined" class="font-bold">0</span></div>
                        <div class="stat-item"><span>üé∞ S·ªë l·∫ßn quay Gacha:</span> <span id="gachaPullsStat" class="font-bold">0</span></div>
                    </div>
                    <div class="stats-section">
                        <h3 class="font-semibold text-base text-green-400">Kinh T·∫ø</h3>
                        <div class="stat-item"><span>üìà Ti·ªÅn ki·∫øm ƒë∆∞·ª£c:</span> <span id="moneyEarned" class="font-bold">0 $</span></div>
                        <div class="stat-item"><span>üìâ Ti·ªÅn ƒë√£ ti√™u:</span> <span id="moneySpent" class="font-bold">0 $</span></div>
                    </div>
                    <div class="stats-section">
                        <h3 class="font-semibold text-base text-cyan-400">Th∆∞·ªüng T·ª´ Hero</h3>
                        <div class="stat-item"><span>üí∞ Ti·ªÅn c·ªông/kh·ªëi:</span> <span id="heroFlatBonusStat" class="font-bold text-green-400">+0 $</span></div>
                        <div class="stat-item"><span>‚úñÔ∏è H·ªá s·ªë nh√¢n ti·ªÅn:</span> <span id="heroMultiplierStat" class="font-bold text-green-400">x1.00</span></div>
                    </div>
                     <div class="stats-section">
                        <h3 class="font-semibold text-base text-red-400">Chi·∫øn ƒë·∫•u (Dungeon)</h3>
                        <div class="stat-item"><span>‚öîÔ∏è S√°t th∆∞∆°ng:</span> <span id="playerDamageStat" class="font-bold">1</span></div>
                    </div>
                </div>
                <!-- Column 2 -->
                <div class="space-y-6">
                    <div class="stats-section">
                        <h3 class="font-semibold text-base text-blue-400">B·ªô S∆∞u T·∫≠p</h3>
                        <div class="stat-item"><span>ü¶∏‚Äç‚ôÇÔ∏è Nh√¢n v·∫≠t ƒëang s·ªü h·ªØu:</span> <span id="ownedHeroesStat" class="font-bold">0</span></div>
                        <div class="stat-item"><span>üìø Di v·∫≠t ƒëang s·ªü h·ªØu:</span> <span id="ownedArtifactsStat" class="font-bold">0</span></div>
                    </div>
                    <div class="stats-section h-full">
                        <h3 class="font-semibold text-base text-blue-400">Kh·ªëi ƒê√£ ƒê√†o</h3>
                        <div id="mined-blocks-stats" class="space-y-1 max-h-64 overflow-y-auto custom-scrollbar">
                            <p class="text-slate-400 text-center">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>
                        </div>
                    </div>
                    <div class="stats-section">
                         <h3 class="font-semibold">Giftcode</h3>
                         <div class="flex gap-2">
                             <input id="giftcode-input" type="text" class="bg-slate-900/50 rounded-md px-2 py-1 flex-grow text-white" placeholder="Nh·∫≠p code...">
                             <button id="giftcode-submit" class="btn-primary !w-auto px-4">OK</button>
                         </div>
                         <p id="giftcode-message" class="text-sm text-center mt-2 h-4"></p>
                    </div>
                    <div class="stats-section">
                        <h3 class="font-semibold">Qu·∫£n l√Ω D·ªØ li·ªáu</h3>
                        <div class="flex flex-col gap-2">
                            <button id="save-game-btn" class="btn-primary !bg-blue-600 hover:!bg-blue-500">L∆∞u Game</button>
                            <button id="reset-game-btn" class="btn-primary !bg-red-700 hover:!bg-red-600">Reset Game</button>
                        </div>
                        <p class="text-xs text-slate-500 text-center mt-2">L·∫ßn l∆∞u cu·ªëi: <span id="last-saved-time">Ch∆∞a l∆∞u</span></p>
                    </div>
                </div>
            </div>
        </div>
    </template>
    
    <template id="template-gacha">
        <div class="panel">
            <div id="gacha-banner-list" class="space-y-2 mb-4">
                <!-- Banner list will be rendered here -->
            </div>
            <div id="gacha-banner-content">
                <p class="text-slate-400 text-center">Ch·ªçn m·ªôt banner ƒë·ªÉ xem chi ti·∫øt.</p>
            </div>
        </div>
    </template>

    <template id="template-dungeon">
        <div class="panel">
            <h2 class="font-bold text-lg text-center border-b border-slate-600 pb-2 mb-3">Dungeon</h2>
            <div class="text-center">
                <p class="text-slate-400">T·∫ßng cao nh·∫•t:</p>
                <p id="dungeon-highest-floor" class="text-4xl font-bold text-amber-400 mb-4">0</p>
                <button id="start-dungeon-btn" class="btn-primary">B·∫Øt ƒë·∫ßu</button>
            </div>
        </div>
    </template>

    <template id="template-equipment">
        <div class="panel !max-w-6xl min-h-[80vh]"> <!-- Changed: Increased width and height -->
            <h2 class="font-bold text-lg border-b border-slate-600 pb-1 mb-3">Trang B·ªã</h2>
            <div class="mb-4">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-amber-400 font-semibold">Anh H√πng (<span id="equipped-hero-count">0</span>/3)</h3>
                    <button id="quick-equip-heroes" class="btn-primary !w-auto px-3 text-xs">Trang b·ªã nhanh</button>
                </div>
                <div id="hero-collection" class="grid-container custom-scrollbar">
                    <!-- Hero items will be populated by JavaScript -->
                </div>
            </div>
            <div>
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-cyan-400 font-semibold">Di V·∫≠t (<span id="equipped-artifact-count">0</span>/2)</h3>
                </div>
                <div id="artifact-collection" class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar">
                    <!-- Artifact items will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </template>

    <template id="template-music">
        <div class="panel">
            <h2 class="font-bold text-lg border-b border-slate-600 pb-1 mb-2">√Çm nh·∫°c n·ªÅn</h2>
            <div class="space-y-4">
                <div class="text-center">
                    <div class="text-sm text-slate-400 mb-1">ƒêang ph√°t</div>
                    <div id="current-track-name" class="font-semibold text-amber-400">Track 1</div>
                </div>
                <div class="flex items-center justify-center gap-3">
                    <button id="music-prev" class="toggle-button" title="B√†i tr∆∞·ªõc">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="19,20 9,12 19,4"/><line x1="5" y1="19" x2="5" y2="5"/></svg>
                    </button>
                    <button id="music-play-pause" class="toggle-button active" title="Ph√°t/T·∫°m d·ª´ng">
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5,3 19,12 5,21"/></svg>
                        <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                    </button>
                    <button id="music-next" class="toggle-button" title="B√†i ti·∫øp">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5,4 15,12 5,20"/><line x1="19" y1="5" x2="19" y2="19"/></svg>
                    </button>
                    <button id="music-loop-single" class="toggle-button" title="L·∫∑p l·∫°i b√†i h√°t">
                        <svg id="loop-off-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 17H9a4 4 0 0 1-4-4V7"/><path d="M7 7H15a4 4 0 0 1 4 4v6"/><path d="m7 11 4 4L7 19"/><path d="m17 13-4-4 4-4"/></svg>
                        <svg id="loop-on-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><path d="M17 17H9a4 4 0 0 1-4-4V7"/><path d="M7 7H15a4 4 0 0 1 4 4v6"/><path d="m7 11 4 4L7 19"/><path d="m17 13-4-4 4-4"/><path d="M12 17v.01"/><path d="M6 7v.01"/></svg>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="flex items-center justify-between text-sm">
                        <span>√Çm l∆∞·ª£ng</span>
                        <span id="volume-display">16%</span>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="100" value="16" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider">
                </div>
                <div class="space-y-2">
                    <div class="text-sm font-semibold text-slate-300">Danh s√°ch b√†i h√°t</div>
                    <div id="track-list" class="space-y-1 max-h-32 overflow-y-auto custom-scrollbar">
                        <!-- Track items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- T·∫£i th∆∞ vi·ªán Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Li√™n k·∫øt ƒë·∫øn t·ªáp JavaScript ngo√†i -->
    <script src="script.js"></script>
</body>
</html>
